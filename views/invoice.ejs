<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <title>Invoice</title>
</head>
<body>
  <div class="container my-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>Invoice</h2>
      <div>
        <button class="btn btn-outline-secondary" onclick="window.print()">Print</button>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-6">
        <h6>Bill to</h6>
        <p>
          <strong><%= user ? user.username : 'Guest' %></strong><br>
          <%= user && user.address ? user.address.replace(/\n/g,'<br>') : 'No address provided' %>
        </p>
      </div>
      <div class="col-md-6 text-md-end">
        <h6>Invoice summary</h6>
        <p>Invoice date: <%= new Date().toLocaleDateString() %></p>
      </div>
    </div>

    <div class="table-responsive mb-3">
      <table class="table table-bordered align-middle">
        <thead class="table-light">
          <tr>
            <th style="width:48px">#</th>
            <th>Product</th>
            <th style="width:100px">Unit</th>
            <th style="width:100px">Quantity</th>
            <th style="width:120px">Line total</th>
          </tr>
        </thead>
        <tbody>
        <% if (!items || items.length === 0) { %>
          <tr><td colspan="5" class="text-center">Your cart is empty.</td></tr>
        <% } else { %>
          <% items.forEach(function(item, idx) { %>
            <tr>
              <td><%= idx + 1 %></td>
              <td>
                <div class="d-flex align-items-center">
                  <% if (item.image) { %>
                    <img src="/images/<%= item.image %>" alt="" style="height:48px; width:48px; object-fit:cover; margin-right:8px;">
                  <% } %>
                  <div>
                    <div><strong><%= item.productName || item.name || 'Item' %></strong></div>
                    <small class="text-muted"><%= item.category || '' %></small>
                  </div>
                </div>
              </td>
              <td>$<%= Number(item.price).toFixed(2) %></td>
              <td><%= item.quantity %></td>
              <td>$<%= (item.lineTotal || (item.price * item.quantity)).toFixed(2) %></td>
            </tr>
          <% }); %>
        <% } %>
        </tbody>
      </table>
    </div>

    <div class="row">
      <div class="col-md-6">
        <p class="text-muted small">Thank you for shopping with us.</p>
      </div>
      <div class="col-md-6">
        <table class="table table-borderless">
          <tbody>
            <tr>
              <th class="text-end">Subtotal</th>
              <td class="text-end">$<%= Number(typeof subtotal !== 'undefined' ? subtotal : 0).toFixed(2) %></td>
            </tr>
            <tr>
              <th class="text-end">Tax</th>
              <td class="text-end">$<%= Number(typeof tax !== 'undefined' ? tax : 0).toFixed(2) %></td>
            </tr>
            <tr>
              <th class="text-end">Shipping</th>
              <td class="text-end">$<%= Number(typeof shipping !== 'undefined' ? shipping : 0).toFixed(2) %></td>
            </tr>
            <tr class="table-active">
              <th class="text-end">Total</th>
              <th class="text-end">$<%= Number(typeof total !== 'undefined' ? total : 0).toFixed(2) %></th>
            </tr>
          </tbody>
        </table>

        <form action="/checkout/confirm" method="POST">
          <% /* include a simple CSRF/token field here if you use one */ %>
          <button type="submit" class="btn btn-success w-100">Confirm and Pay</button>
        </form>
      </div>
    </div>
  </div>
</body>
</html>